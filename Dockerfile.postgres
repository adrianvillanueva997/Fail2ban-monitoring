FROM python:3.11-slim

WORKDIR /app

# Install uv package manager
RUN pip install --no-cache-dir uv

# Copy project files
COPY . .

# Install project dependencies with PostgreSQL extras
RUN uv pip install -e ".[postgres]"

# Set environment variables
ENV PYTHONUNBUFFERED=1
ENV DB_TYPE=postgres
ENV DB_HOST=postgres
ENV DB_PORT=5432
ENV DB_USER=fail2ban
ENV DB_PASSWORD=fail2banpassword
ENV DB_NAME=fail2ban

# Command to run when container starts
CMD ["python", "-m", "src.main"]